import express from 'express';

import actionsRouter from './actions';
import redirectsRouter from './redirects';
import rootRouter from './root';
import routesData from './routes-data';
import ssr from 'renderers/server';

const router = express.Router({ caseSensitive: true });

router.use('/actions', actionsRouter);

router.use('/', redirectsRouter);
router.use('/', rootRouter);

// Get requests that SSR a route-aware React component.
Object.entries(routesData).forEach(([routeId, routeData]) => {
  router.get(routeData.path, async (req, res) => {
    try {
      const ssrData = await ssr(routeId);
      res.render('main', { viewData: { ...routeData, ...ssrData } });
    } catch (err) {
      console.error(err); // TODO: report to monitoring service
      res.status(500).send('Something went wrong');
    }
  });
});

export default router;
