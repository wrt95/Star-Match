import React from 'react';
import url from 'url';
import { StoreNavigate } from 'store/history';

const LinkG = (mergeState, data) => {
  const Link = ({ to, newState, newTitle, className = 'link', children }) => {
    const handleClick = (event) => {
      if (!event.ctrlKey && !event.metaKey) {
        event.preventDefault();
        const { pathname, query } = url.parse(to, true);
        if (Object.keys(query).length > 0) {
          if (!newState) {
            newState = {};
          }
          newState.pathQuery = query;
        }
        StoreNavigate(
          mergeState,
          data,
        )({
          newPath: pathname,
          newTitle,
          newState,
        });
      }
    };

    if (typeof children === 'string' || React.Children.count(children) > 1) {
      return (
        <a href={to} className={className} onClick={handleClick}>
          {children}
        </a>
      );
    }

    return React.cloneElement(React.Children.only(children), {
      onClick: handleClick,
    });
  };
  return Link;
};

export default LinkG;
