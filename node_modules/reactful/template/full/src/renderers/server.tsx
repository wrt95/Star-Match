import React from 'react';
import ReactDOMServer from 'react-dom/server';
import serialize from 'serialize-javascript';
import routesData from 'server/routers/routes-data';
import { compress } from 'utilities/compress';
import Root from 'components';

export default async function serverRenderer(routeId) {
  const title = routesData[routeId];
  const initState = {
    currentRouteId: routeId,
    currentTitle: title,
  };

  const gData = {
    appName: 'Reactful',
    routesData,
    initRoute: {
      // These are used for the first "fake" history record
      id: routeId,
      title,
    },
  };

  // TODO: Streamify
  const initialMarkup = ReactDOMServer.renderToString(
    <Root initState={initState} gData={gData} />,
  );

  return {
    seedData: compress(serialize({ initState, gData })),
    initialMarkup,
  };
}
